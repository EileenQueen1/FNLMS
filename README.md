# LMS, NLMS, VSLMS 对比
Originally Designed by linmh0130@stu.xjtu.edu.cn

Refined (or rather, muddled with more errors ) by [24s153046@stu.hit.edu.cn](mailto:24s153046@stu.hit.edu.cn)

---

simLMS.m：用于仿真的LMS函数

simNLMS.m：用于仿真的NLMS函数

simVSLMS.m：用于仿真的VSLMS函数

​	variableStepSize.m：一种步长更新逻辑

​	dynamicStepSize.m：另一种步长更新逻辑（未采用）

tightfig.m：用于精简fig内容

---

## 理论基础

+ LMS算法是一种基于梯度下降的Wiener算法，下面还提出了它的一些改进算法

+ NLMS算法，归一化的LMS算法，使用对参考信号的功率估计来调整步长；

  + $\mu = \cfrac{M}{L}\cfrac{\alpha}{\boldsymbol{x}^\top \boldsymbol{x}}$，其中$\alpha$为人为设定的参数，$M$是功率估计使用的平移窗，$L$是滤波器长度；

+ VSLMS算法，变步长LMS算法

  通过动态调整自适应滤波器的步长参数，在收敛速度与稳态误差间实现最优平衡。每个权重分量独立调整步长，适应不同梯度变化特征。

  - **误差驱动机制**  
    误差信号 $$e(k) = d(k) - \mathbf{w}^T(k)\mathbf{u}(k)$$ 驱动权重更新，其中：  
    
    - $\mathbf{u}(k)$：输入向量（当前及历史输入值的滑动窗口）  
    - $\mathbf{w}(k)$：自适应滤波器权重向量  
    
  - **梯度符号跟踪**  
    记录每个权重分量梯度的符号历史（`gradSign`矩阵），分析其连续性：  
    - **连续同符号（梯度方向一致）** → 增大步长加速收敛  
    - **频繁变符号（梯度方向振荡）** → 减小步长抑制超调  

  - **步长动态调整规则**  
    通过`variableStepSize`函数实现以下逻辑：  
    $$
    \mu_i(k+1) = \begin{cases} 
    \mu_i(k) \cdot a & \text{if 连续同符号次数} \geq m_1 \\
    \mu_i(k) / a & \text{if 连续同符号次数} \leq m_0-1 \\
    \mu_i(k) & \text{其他情况}
    \end{cases}
    $$
    参数定义：  
    - $$a=2$$：步长缩放因子  
    - $$m_0=2, m_1=3$$：符号稳定性阈值（代码中硬编码值）  
    - $$\mu \in [\mu_{\text{min}}, \mu_{\text{max}}]$$：步长饱和区间（由输入参数`mu0`指定）

## LMS算法测试 (demo1)

#### 实验设置

设计一个4阶FIR滤波器 $H(q^{-1})$ `h = [0.3, 0.5, -0.2, 0.1]`

设计输入信号，输入信号中存在高斯白噪声作为随机扰动

$x(t)=\sin(2\pi\Omega t)+e(t),\ e(t)\sim N(0,0.25)$，$\Omega=0.05\text{rad}$

输出信号由输入信号经过滤波得到，存在高斯白噪声作为随机扰动

$d(t)=H(q^{-1})x(t)+v(t),\ v(t)\sim N(0,0.01)$

+ 样本个数：`N = 1000`
+ 步长参数：`mu = 0.01`
+ 滤波器阶次：`M = 4`

#### 实验结果

提供给定的输入、输出信号使用simLMS函数滤波

+ 滤波器输出y逐渐逼近期望信号d，误差信号e收敛
+ simLMS函数统计得出参考信号的自相关矩阵R，参考信号与期望信号的互相关向量p
+ 使用自相关矩阵R与权重误差向量（对比真值）估计MSE，得到MSE的学习曲线
+ 所设计的滤波器参数真值、使用Wiener-Hopf公式确定的最优权重$W_{opt}=R^{-1}p$、收敛的估计权重系数对比

<figure>
    <img src="assets\1-1.svg" width = 49% />
    <img src="assets\1-2.svg" width = 49% />
</figure>

#### 引申问题（TBD）

1. 在计算R,p的过程中使用的参考信号与期望信号含有随机扰动，是否会对估计造成影响？
2. 当选择多种不同步长进行试验时，步长和算法的收敛性能之间是否存在折衷？能够收敛的步长上界是什么？
3. 根据上述题设能否计算出理论最优的步长？

## LMS与NLMS对比测试（demo2）

#### 实验设置

设计一个4阶FIR滤波器 $H(q^{-1})$ `h = [0.3, 0.5, -0.2, 0.1]`

设计输入信号，输入信号中存在高斯白噪声作为随机扰动，$\Omega=0.05\text{rad}$

$x(t)=0.2\sin(2\pi\Omega t)+e(t),\ e(t)\sim N(0,0.01)$

输出信号由输入信号经过滤波得到，存在高斯白噪声作为随机扰动

$d(t)=H(q^{-1})x(t)+v(t),\ v(t)\sim N(0,10^{-4})$

+ 步长参数：`mu = 0.05`
+ NLMS的步长调整：`mu = mu/(eps+u*u')`

<font color = red>*设置作了微小改动，降低了输入信号中的白噪声成分，标准LMS算法受到的性能影响更大，输入信号中的确定性成分幅值减小，以使NLMS算法具有更好地表现，突出对比。</font>

<font color = red>*但由于NLMS算法的步长可变，两算法的实际步长未必一致，个人认为在这里两种算法之间的较量算不上“公平”，实验设计可能需要改进。</font>

#### 实验结果

提供给定的输入、输出信号使用simLMS函数滤波

+ 相较于固定某步长的LMS算法，NLMS算法在收敛速率、收敛误差两方面都显著优于LMS算法；
+ 在给定的实验条件下，LMS算法未能收敛到最优稳态权重，而NLMS算法具有更好的收敛性能。

<figure>
    <img src="assets\2-1.svg" width = 49% />
    <img src="assets\2-2.svg" width = 49% />
</figure>

#### 引申问题（TBD）

1. NLMS算法似乎也可以看作一种变步长算法。并且如果对算法的步长更新统计会发现步长不会随时间发生收敛，并且直到迭代的后期仍在发生较大幅度的涨落。
2. 从理论上如何说明此时（白噪声成分减少）LMS算法性能的下降？受到什么的限制？
3. 信号的信噪比如何计算？最终性能是否与信噪比有关？

## LMS与VSLMS对比测试（demo3）

#### 实验设置

设计一个4阶FIR滤波器 $H(q^{-1})$ `h = [0.3, 0.5, -0.2, 0.1]`

设计输入信号，输入信号中存在高斯白噪声作为随机扰动，$\Omega=0.05\text{rad}$

$x(t)=\sin(2\pi\Omega t)+e(t),\ e(t)\sim N(0,0.16)$

输出信号由输入信号经过滤波得到，存在高斯白噪声作为随机扰动

$d(t)=H(q^{-1})x(t)+v(t),\ v(t)\sim N(0,10^{-4})$

#### 实验结果

+ VSLMS算法具有更快的收敛速度；
+ VSLMS算法的权重向量有概率收敛到最优值（但有时候情况相较于LMS更差，并不能保证实验结果稳定出现）

<figure align = center>
    <img src="assets\3-1.svg" width = 70% />
</figure>

#### 引申问题（TBD）

1. 绘制VSLMS算法的步长收敛曲线
2. 没有说明变步长算法所涉及的步长上下限如何选取
3. 只提供了其中一种版本的步长更新算法

## LMS与VSLMS算法等高线图示（demo4）

#### 实验设置

- **传统LMS算法**：
  固定步长（`mu=5e-2`），验证其在稳态误差与收敛速度间的权衡。

- **变步长VSLMS算法**：

  动态调整步长（`mu_max=0.1/max(eig(R))`，`mu_min=5e-5`），探索其能否实现：

  1. **快速收敛**：初始大步长加速权重更新
  2. **低稳态误差**：后期小步长抑制震荡

+ 设计一个2阶FIR滤波器`H = [1,0]`，绘制MSE的等高线图像收敛。

+ 参考信号`x[n]`是一个方差随机的零均值高斯白噪声，使用2维正定矩阵生成；
+ 目标信号`d[n]`由**正弦波（频率`W=20π`）叠加高斯白噪声**构成，SNR参数（0.1~50）用于调节信噪比，模拟不同噪声强度场景。

#### 实验内容

<font color = red>在给定程序中的VSLMS算法性能并不稳定，在SNR较小的情况下甚至比不上LMS算法，优势并不显著</font>

<figure>
    <img src="assets\4-1.svg" width = 49% />
    <img src="assets\4-2.svg" width = 49% />
</figure>

## 不足与改进建议

1. 为了突出算法的特点，每个实验假设的参考信号与随机扰动信号幅值都发生了变化，这些假设并没有结合理论分析，因此并不合理；
2. 仿真实验没有结合理论分析，对于各种LMS算法的变体没有设计能够突出算法特点的程序，对于各种算法仍然缺乏足够的了解；
3. 所设置的题设过于简单，须“辨识”的FIR滤波器长度太短；

## 参考文献

[1] KUO S M, MORGAN D R. Active noise control systems: algorithms and DSP implementations[M]. New York: Wiley, 1996.
